---
import NavbarMenu from "../islands/NavbarMenu.jsx";
import ThemeToggle from "../islands/ThemeToggle.jsx";
const {
  taxonomy = ["all", "read", "play", "about"],
  type = "all",
  sort = "newest",
  currentPage = 1,
} = Astro.props;
---

<header class="site-header">
  <div class="site-header-inner">
    <div class="navbar-content-inner">
      <div class="navbar-header-row" style="display: flex; align-items: center; justify-content: space-between; gap: 0; width: 100%;">
        <a href="/" class="nav__logo">
          <img src="/assets/k_blk_svg.svg" alt="Logo" class="nav__logo-img" />
          <span>KJK</span>
        </a>
        <div class="nav__search-stretch" style="flex: 1 1 auto; display: flex; justify-content: center; align-items: center; max-width: 420px; margin: 0 1.5rem;">
          <input type="text" placeholder="Search (coming soon)" class="nav__search-input" disabled />
        </div>
        <div class="navbar-menu-wrapper" style="flex: 0 0 auto; display: flex; align-items: center; height: 100%;">
          <NavbarMenu
            taxonomy={taxonomy}
            type={type}
            sort={sort}
            client:load
          >
            <ThemeToggle />
          </NavbarMenu>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  // Removed conflicting DOMContentLoaded event listener to avoid conflicts with menuOpen state in NavbarMenu.jsx
</script>

<style>
  /* Navbar Styles */
  .site-header {
    position: fixed;
    top: 0; /* Ensure the top of the navbar is flush with the viewport */
    left: 50%; /* Align to the center of the viewport */
    transform: translateX(-50%); /* Center the header */
    z-index: 10;
    backdrop-filter: blur(18px) saturate(180%); /* Apply frosted glass effect */
    -webkit-backdrop-filter: blur(18px) saturate(180%); /* Safari support */
    background: rgba(255, 255, 255, 0.95); /* Match dropdown background */
    border: 1.5px solid var(--color-border, #d6d5c9); /* Match dropdown border */
    padding: 0;
    max-width: var(--feed-max-width); /* Match feed width */
    width: 100%;
    box-sizing: border-box;
    box-shadow: 0 12px 32px -4px rgba(0,0,0,0.18), 0 1.5px 0 0 rgba(0,0,0,0.04);
  }

  .site-header-helper {
    display: none; /* Hide the helper element to remove the gap */
  }

  .site-header-inner {
    max-width: var(--feed-max-width); /* Ensure inner content matches feed width */
    margin: 0 auto; /* Center the inner content */
    width: 100%;
    box-sizing: border-box;
  }

  .navbar-content-inner {
    max-width: var(--feed-max-width); /* Match feed width */
    width: 100%;
    margin: 0 auto; /* Center the navbar content */
    box-sizing: border-box;
  }

  .navbar-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    height: var(--navbar-height);
    margin: 0;
    box-sizing: border-box;
    overflow: visible;
    z-index: 11;
  }

  .nav__search-stretch {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    max-width: 240px; /* Adjusted to be more compact */
  }

  .nav__menu-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.3em 0.6em;
    border-radius: 4px;
    background: var(--color-bg-alt);
    border: 1px solid var(--color-border);
    cursor: pointer;
    font-size: 0.85em;
    color: var(--color-text);
    transition: background 0.2s;
  }

  .nav__menu-btn:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .nav__menu-btn select {
    border: none;
    background: transparent;
    font-size: 0.85em;
    color: var(--color-text);
    cursor: pointer;
  }

  .nav__menu-btn select:focus {
    outline: none;
  }

  /* Dropdown Styles */
  :global(#filter-sort-menu) {
    display: flex;
    flex-direction: row; /* Ensure items are in a single row */
    justify-content: space-between; /* Distribute items evenly */
    align-items: center; /* Center items vertically */
    gap: 0.5rem; /* Add spacing between items */
    padding: 0.5rem; /* Adjust padding for better spacing */
    background: rgba(255, 255, 255, 0.9); /* Slightly opaque background */
    border: 1px solid var(--color-border);
    border-radius: 4px; /* Rounded corners */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
  }

  :global(#filter-sort-menu button),
  :global(#filter-sort-menu select) {
    flex: none; /* Prevent items from stretching */
    margin: 0; /* Remove any default margins */
    padding: 0.3rem 0.6rem; /* Adjust padding for compactness */
    font-size: 0.85em; /* Slightly smaller font size */
  }

  :global(#filter-sort-menu ._menu-content_2gfve_71) {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 1.2rem 1.2rem 1rem 1.2rem;
  }

  :global(#filter-sort-menu .menu-section) {
    margin: 0;
    padding: 0;
  }

  :global(#filter-sort-menu ul),
  :global(#filter-sort-menu li) {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  :global(#filter-sort-menu ._pill-list_2gfve_106),
  :global(#filter-sort-menu .pill),
  :global(#filter-sort-menu ._pill_2gfve_106) {
    display: none !important;
  }

  :global(#filter-sort-menu button:hover),
  :global(#filter-sort-menu .dropdown-item:hover),
  :global(#filter-sort-menu button:focus),
  :global(#filter-sort-menu .dropdown-item:focus) {
    background: rgba(34,34,34,0.08);
    color: #111;
  }

  :global(#filter-sort-menu h2) {
    font-family: 'Oswald', 'Oswald-VariableFont_wght', Arial, sans-serif !important;
    font-size: 1.02rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    color: #333;
    margin: 0 0 0.5em 0;
    padding: 0;
    text-transform: uppercase;
  }

  @media (max-width: 768px) {
    .menu-content {
      flex-direction: column;
      gap: 1rem;
    }
    .menu-section h2 {
      margin-bottom: 0.3rem;
      font-size: 0.75rem;
    }
    .pill {
      padding: 0.25rem 0.6rem;
      font-size: 0.85em;
    }
  }
  @media (max-width: 480px) {
    .pill-list {
      gap: 0.3rem;
    }
    .pill {
      padding: 0.2rem 0.5rem;
      font-size: 0.8em;
    }
  }
</style>
